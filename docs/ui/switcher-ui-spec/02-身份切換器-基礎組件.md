# éšæ®µ 2ï¸âƒ£: èº«ä»½åˆ‡æ›å™¨ - åŸºç¤çµ„ä»¶

## ğŸ¯ ç›®æ¨™

å¯¦ä½œèº«ä»½åˆ‡æ›å™¨çš„æ ¸å¿ƒ UI çµ„ä»¶:
- è§¸ç™¼æŒ‰éˆ• (Trigger Button)
- ä¸‹æ‹‰é¸å–® (MatMenu)
- é¸å–®é …ç›®æ¨£å¼
- åŸºæœ¬çš„è¦–è¦ºè¨­è¨ˆ

**é ä¼°æ™‚é–“**: 3-4 å°æ™‚
**ä¾è³´**: éšæ®µ 1 (åŸºç¤æ¶æ§‹è¨­ç½®)

---

## ğŸ“ æª”æ¡ˆçµæ§‹

```
src/app/
â”œâ”€â”€ presentation/                         # Presentation Layer (å±•ç¤ºå±¤)
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ header/
â”‚   â”‚       â”œâ”€â”€ components/
â”‚   â”‚       â”‚   â””â”€â”€ account-switcher/
â”‚   â”‚       â”‚       â”œâ”€â”€ account-switcher.component.ts
â”‚   â”‚       â”‚       â”œâ”€â”€ account-switcher.component.html
â”‚   â”‚       â”‚       â”œâ”€â”€ account-switcher.component.scss
â”‚   â”‚       â”‚       â””â”€â”€ account-switcher.component.spec.ts
â”‚   â”‚       â””â”€â”€ header.component.ts
```

---

## ğŸ“ æ­¥é©Ÿ 1: å»ºç«‹çµ„ä»¶

### 1.1 ç”¢ç”Ÿçµ„ä»¶

```bash
# ä½¿ç”¨ Angular CLI ç”¢ç”Ÿçµ„ä»¶
ng generate component presentation/layouts/header/components/account-switcher --standalone
```

### 1.2 çµ„ä»¶ TypeScript (`account-switcher.component.ts`)

```typescript
// src/app/presentation/layouts/header/components/account-switcher/account-switcher.component.ts
import { Component, computed, inject, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { MatButtonModule } from '@angular/material/button';
import { MatMenuModule } from '@angular/material/menu';
import { MatIconModule } from '@angular/material/icon';
import { MatDividerModule } from '@angular/material/divider';
import { MatProgressSpinnerModule } from '@angular/material/progress-spinner';

import { AccountStore } from '@/application/store/account';
import { AccountType } from '@/domain/account/entities';

@Component({
  selector: 'app-account-switcher',
  standalone: true,
  imports: [
    CommonModule,
    MatButtonModule,
    MatMenuModule,
    MatIconModule,
    MatDividerModule,
    MatProgressSpinnerModule
  ],
  templateUrl: './account-switcher.component.html',
  styleUrl: './account-switcher.component.scss'
})
export class AccountSwitcherComponent {
  // Stores
  protected accountStore = inject(AccountStore);
  
  // é¸å–®ç‹€æ…‹
  protected isMenuOpen = signal(false);
  
  // å…¬é–‹ AccountType çµ¦æ¨¡æ¿ä½¿ç”¨
  protected readonly AccountType = AccountType;
  
  // Computed values
  protected displayName = computed(() => {
    const account = this.accountStore.account();
    if (!account) return 'æœªç™»å…¥';
    
    // æ ¹æ“šå¸³è™Ÿé¡å‹å–å¾—åç¨±
    if (account.type === AccountType.User) {
      return account.displayName || account.name;
    }
    return account.name;
  });
  
  protected avatarUrl = computed(() => {
    return this.accountStore.accountAvatar();
  });
  
  protected accountType = computed(() => {
    return this.accountStore.account()?.type;
  });
  
  /**
   * é¸å–®é–‹å•Ÿ
   */
  onMenuOpened(): void {
    this.isMenuOpen.set(true);
  }
  
  /**
   * é¸å–®é—œé–‰
   */
  onMenuClosed(): void {
    this.isMenuOpen.set(false);
  }
  
  /**
   * å–å¾—å¸³è™Ÿé¡å‹åœ–ç¤º
   */
  getAccountTypeIcon(type: AccountType): string {
    switch (type) {
      case AccountType.User:
        return 'person';
      case AccountType.Organization:
        return 'business';
      case AccountType.Team:
        return 'groups';
      case AccountType.Partner:
        return 'handshake';
      default:
        return 'person';
    }
  }
  
  /**
   * å–å¾—å¸³è™Ÿé¡å‹å¾½ç« é¡è‰²
   */
  getBadgeColor(type: AccountType): string {
    switch (type) {
      case AccountType.Organization:
        return 'primary';
      case AccountType.Team:
        return 'accent';
      case AccountType.Partner:
        return 'warn';
      default:
        return '';
    }
  }
}
```

---

## ğŸ“ æ­¥é©Ÿ 2: å»ºç«‹æ¨¡æ¿

### 2.1 HTML æ¨¡æ¿ (`account-switcher.component.html`)

```html
<!-- src/app/layout/header/account-switcher/account-switcher.component.html -->

<!-- è§¸ç™¼æŒ‰éˆ• -->
<button
  mat-button
  class="account-trigger"
  [matMenuTriggerFor]="accountMenu"
  (menuOpened)="onMenuOpened()"
  (menuClosed)="onMenuClosed()"
  aria-label="åˆ‡æ›èº«ä»½"
  [attr.aria-expanded]="isMenuOpen()">
  
  <!-- é ­åƒå€åŸŸ -->
  <div class="avatar-container">
    @if (avatarUrl(); as avatar) {
      <img
        [src]="avatar"
        [alt]="displayName()"
        class="avatar"
        loading="lazy">
    } @else {
      <mat-icon class="avatar-icon">
        {{ getAccountTypeIcon(accountType() || AccountType.User) }}
      </mat-icon>
    }
    
    <!-- èº«ä»½é¡å‹å¾½ç«  -->
    @if (accountType() && accountType() !== AccountType.User) {
      <span
        class="badge"
        [attr.data-type]="accountType()">
      </span>
    }
  </div>
  
  <!-- å¸³è™Ÿåç¨± -->
  <span class="account-name">{{ displayName() }}</span>
  
  <!-- ä¸‹æ‹‰ç®­é ­ -->
  @if (!globalShell.isLoading()) {
    <mat-icon
      class="dropdown-icon"
      [class.rotated]="isMenuOpen()">
      expand_more
    </mat-icon>
  } @else {
    <mat-spinner diameter="16" class="loading-spinner"></mat-spinner>
  }
</button>

<!-- ä¸‹æ‹‰é¸å–® -->
<mat-menu
  #accountMenu="matMenu"
  class="account-menu"
  xPosition="before"
  yPosition="below">
  
  <!-- å€‹äººå¸³è™Ÿå€å¡Š -->
  <div class="menu-section">
    <div class="section-title">å€‹äººå¸³è™Ÿ</div>
    
    <button
      mat-menu-item
      class="account-item"
      [class.active]="accountType() === AccountType.User">
      
      <div class="account-item-content">
        <!-- å·¦å´:é ­åƒ -->
        <div class="item-avatar">
          @if (avatarUrl(); as avatar) {
            <img [src]="avatar" [alt]="displayName()">
          } @else {
            <mat-icon>person</mat-icon>
          }
        </div>
        
        <!-- ä¸­é–“:è³‡è¨Š -->
        <div class="item-info">
          <div class="item-name">{{ displayName() }}</div>
          <div class="item-meta">User</div>
        </div>
        
        <!-- å³å´:å‹¾é¸åœ–ç¤º -->
        @if (accountType() === AccountType.User) {
          <mat-icon class="check-icon">check</mat-icon>
        }
      </div>
    </button>
  </div>
  
  <mat-divider></mat-divider>
  
  <!-- çµ„ç¹”å€å¡Š -->
  <div class="menu-section">
    <div class="section-title">çµ„ç¹”</div>
    
    <!-- TODO: é€™è£¡å°‡å¾ Store å–å¾—çµ„ç¹”åˆ—è¡¨ -->
    <div class="empty-state">
      å°šæœªåŠ å…¥ä»»ä½•çµ„ç¹”
    </div>
  </div>
  
  <mat-divider></mat-divider>
  
  <!-- åœ˜éšŠå€å¡Š -->
  <div class="menu-section">
    <div class="section-title">åœ˜éšŠ</div>
    
    <div class="empty-state">
      å°šæœªåŠ å…¥ä»»ä½•åœ˜éšŠ
    </div>
  </div>
  
  <mat-divider></mat-divider>
  
  <!-- åˆä½œå¤¥ä¼´å€å¡Š -->
  <div class="menu-section">
    <div class="section-title">åˆä½œå¤¥ä¼´</div>
    
    <div class="empty-state">
      å°šæœªå»ºç«‹åˆä½œå¤¥ä¼´é—œä¿‚
    </div>
  </div>
  
  <mat-divider></mat-divider>
  
  <!-- ç®¡ç†å¸³è™Ÿé¸é … -->
  <button mat-menu-item class="manage-accounts">
    <mat-icon>settings</mat-icon>
    <span>ç®¡ç†å¸³è™Ÿ...</span>
  </button>
</mat-menu>
```

---

## ğŸ“ æ­¥é©Ÿ 3: å»ºç«‹æ¨£å¼

### 3.1 SCSS æ¨£å¼ (`account-switcher.component.scss`)

```scss
// src/app/layout/header/account-switcher/account-switcher.component.scss

// è§¸ç™¼æŒ‰éˆ•
.account-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  height: 48px;
  padding: 8px 12px;
  border-radius: 24px;
  background: transparent;
  transition: background-color 200ms ease;
  
  &:hover {
    background: rgba(0, 0, 0, 0.04);
  }
  
  &:active {
    background: rgba(0, 0, 0, 0.08);
  }
  
  // é ­åƒå®¹å™¨
  .avatar-container {
    position: relative;
    width: 32px;
    height: 32px;
    flex-shrink: 0;
    
    // é ­åƒåœ–ç‰‡
    .avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }
    
    // é ­åƒåœ–ç¤º (å‚™ç”¨)
    .avatar-icon {
      width: 100%;
      height: 100%;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.12);
      border-radius: 50%;
      color: rgba(0, 0, 0, 0.6);
    }
    
    // èº«ä»½é¡å‹å¾½ç« 
    .badge {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      border: 2px solid white;
      
      &[data-type="organization"] {
        background: #1976d2; // è—è‰²
      }
      
      &[data-type="team"] {
        background: #ff9800; // æ©™è‰²
      }
      
      &[data-type="partner"] {
        background: #4caf50; // ç¶ è‰²
      }
    }
  }
  
  // å¸³è™Ÿåç¨±
  .account-name {
    font-size: 14px;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.87);
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  // ä¸‹æ‹‰ç®­é ­
  .dropdown-icon {
    width: 20px;
    height: 20px;
    font-size: 20px;
    transition: transform 200ms ease;
    
    &.rotated {
      transform: rotate(180deg);
    }
  }
  
  // è¼‰å…¥ä¸­æŒ‡ç¤ºå™¨
  .loading-spinner {
    ::ng-deep .mat-mdc-progress-spinner circle {
      stroke: rgba(0, 0, 0, 0.6);
    }
  }
}

// ä¸‹æ‹‰é¸å–®
::ng-deep .account-menu {
  .mat-mdc-menu-panel {
    width: 280px;
    max-height: 400px;
    border-radius: 8px;
  }
  
  .mat-mdc-menu-content {
    padding: 8px 0;
  }
}

// é¸å–®å€å¡Š
.menu-section {
  padding: 0;
  
  // å€å¡Šæ¨™é¡Œ
  .section-title {
    font-size: 12px;
    font-weight: 500;
    color: rgba(0, 0, 0, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 8px 16px;
    height: 32px;
    line-height: 16px;
  }
  
  // ç©ºç‹€æ…‹
  .empty-state {
    font-size: 12px;
    color: rgba(0, 0, 0, 0.38);
    padding: 12px 16px;
    font-style: italic;
  }
}

// å¸³è™Ÿé¸é …
.account-item {
  height: 56px !important;
  padding: 8px 16px !important;
  
  // ç•¶å‰é¸ä¸­
  &.active {
    background: rgba(63, 81, 181, 0.08);
    
    .item-name {
      font-weight: 500;
    }
  }
  
  // æ‡¸åœæ•ˆæœ
  &:hover:not(.active) {
    background: rgba(0, 0, 0, 0.04);
  }
  
  .account-item-content {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    
    // é ­åƒ
    .item-avatar {
      width: 32px;
      height: 32px;
      flex-shrink: 0;
      
      img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
      }
      
      mat-icon {
        width: 100%;
        height: 100%;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.12);
        border-radius: 50%;
        color: rgba(0, 0, 0, 0.6);
      }
    }
    
    // è³‡è¨Šå€
    .item-info {
      flex: 1;
      min-width: 0;
      
      .item-name {
        font-size: 14px;
        font-weight: 400;
        color: rgba(0, 0, 0, 0.87);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .item-meta {
        font-size: 12px;
        color: rgba(0, 0, 0, 0.6);
        margin-top: 2px;
      }
    }
    
    // å‹¾é¸åœ–ç¤º
    .check-icon {
      width: 20px;
      height: 20px;
      font-size: 20px;
      color: #3f51b5; // Primary color
      flex-shrink: 0;
    }
  }
}

// ç®¡ç†å¸³è™ŸæŒ‰éˆ•
.manage-accounts {
  display: flex;
  align-items: center;
  gap: 12px;
  height: 48px !important;
  
  mat-icon {
    color: rgba(0, 0, 0, 0.6);
  }
  
  span {
    font-size: 14px;
    color: rgba(0, 0, 0, 0.87);
  }
}

// åˆ†éš”ç·š
::ng-deep .account-menu mat-divider {
  margin: 8px 0;
}
```

---

## ğŸ“ æ­¥é©Ÿ 4: æ•´åˆåˆ° Header

### 4.1 æ›´æ–° Header çµ„ä»¶

```typescript
// src/app/layout/header/header.component.ts
import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { MatToolbarModule } from '@angular/material/toolbar';

import { AccountSwitcherComponent } from './account-switcher/account-switcher.component';

@Component({
  selector: 'app-header',
  standalone: true,
  imports: [
    CommonModule,
    MatToolbarModule,
    AccountSwitcherComponent
  ],
  template: `
    <mat-toolbar color="primary" class="app-header">
      <div class="header-container">
        <!-- Logo -->
        <div class="logo">
          <span>My App</span>
        </div>
        
        <!-- Spacer -->
        <span class="spacer"></span>
        
        <!-- èº«ä»½åˆ‡æ›å™¨ -->
        <app-account-switcher />
      </div>
    </mat-toolbar>
  `,
  styles: [`
    .app-header {
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-container {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 0 16px;
    }
    
    .logo {
      font-size: 20px;
      font-weight: 600;
    }
    
    .spacer {
      flex: 1;
    }
  `]
})
export class HeaderComponent {}
```

---

## ğŸ“ æ­¥é©Ÿ 5: åˆå§‹åŒ– Store

### 5.1 åœ¨ App Component åˆå§‹åŒ–

```typescript
// src/app/app.component.ts
import { Component, OnInit, inject } from '@angular/core';
import { RouterOutlet } from '@angular/router';

import { AccountStore } from '@/application/store';
import { HeaderComponent } from './layout/header/header.component';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [
    RouterOutlet,
    HeaderComponent
  ],
  template: `
    <app-header />
    <main class="app-main">
      <router-outlet />
    </main>
  `,
  styles: [`
    :host {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    .app-main {
      flex: 1;
      overflow: auto;
    }
  `]
})
export class AppComponent implements OnInit {
  private globalShell = inject(AccountStore);
  
  ngOnInit(): void {
    // TODO: å¾ Firebase Auth å–å¾—ç•¶å‰ä½¿ç”¨è€…
    // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬è³‡æ–™
    const mockAccount = {
      id: 'user-1',
      type: 'user' as const,
      name: 'Demo User',
      email: 'demo@example.com',
      displayName: 'Demo User',
      photoURL: 'https://i.pravatar.cc/150?img=1',
      createdAt: new Date(),
      updatedAt: new Date()
    };
    
    // è¼‰å…¥ç•¶å‰å¸³è™Ÿ (æš«æ™‚ç›´æ¥è¨­ç½®)
    // this.globalShell.loadCurrentAccount('user-1');
  }
}
```

---

## âœ… é©—è­‰æ¸…å–®

å®Œæˆæ­¤éšæ®µå¾Œ,ç¢ºèªä»¥ä¸‹é …ç›®:

- [ ] AccountSwitcherComponent å¯æ­£å¸¸ç·¨è­¯
- [ ] è§¸ç™¼æŒ‰éˆ•æ­£ç¢ºé¡¯ç¤ºé ­åƒå’Œåç¨±
- [ ] é»æ“ŠæŒ‰éˆ•å¯é–‹å•Ÿä¸‹æ‹‰é¸å–®
- [ ] ä¸‹æ‹‰é¸å–®é¡¯ç¤ºæ­£ç¢ºçš„åˆ†çµ„çµæ§‹
- [ ] ç•¶å‰å¸³è™Ÿæœ‰å‹¾é¸æ¨™è¨˜
- [ ] ç©ºç‹€æ…‹æ–‡å­—æ­£ç¢ºé¡¯ç¤º
- [ ] æ¨£å¼ç¬¦åˆè¨­è¨ˆè¦ç¯„
- [ ] éŸ¿æ‡‰å¼æŒ‰éˆ•äº’å‹•æ­£å¸¸ (hover, active)

---

## ğŸ¨ è¦–è¦ºæª¢æŸ¥

åœ¨ç€è¦½å™¨ä¸­æª¢æŸ¥:

1. **è§¸ç™¼æŒ‰éˆ•**
   - é ­åƒåœ“å½¢,å¤§å° 32x32px
   - åç¨±æ–‡å­— 14px,å¯æˆªæ–·
   - ä¸‹æ‹‰ç®­é ­å¯æ—‹è½‰
   - Hover æ•ˆæœæ­£å¸¸

2. **ä¸‹æ‹‰é¸å–®**
   - å¯¬åº¦ 280px
   - åœ“è§’ 8px
   - é™°å½±æ­£ç¢º
   - ä½ç½®å°é½Šå³å´

3. **é¸å–®é …ç›®**
   - é«˜åº¦ 56px
   - åˆ†çµ„æ¨™é¡Œå°å¯«,ç°è‰²
   - ç©ºç‹€æ…‹æ–œé«”,æ·ºç°è‰²
   - å‹¾é¸åœ–ç¤ºè—è‰²

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q: ä¸‹æ‹‰ç®­é ­æ²’æœ‰æ—‹è½‰å‹•ç•«?
**A**: ç¢ºèª SCSS ä¸­çš„ `transition` å±¬æ€§å’Œ `[class.rotated]` ç¶å®šæ­£ç¢º

### Q: Material çµ„ä»¶æ¨£å¼éŒ¯äº‚?
**A**: ç¢ºèªåœ¨ `angular.json` ä¸­å·²å¼•å…¥ Material ä¸»é¡Œ:
```json
"styles": [
  "@angular/material/prebuilt-themes/indigo-pink.css",
  "src/styles.scss"
]
```

### Q: åœ–ç‰‡ç„¡æ³•é¡¯ç¤º?
**A**: æª¢æŸ¥ CSP æ”¿ç­–æˆ–ä½¿ç”¨æœ¬åœ°åœ–ç‰‡è³‡æº

---

## â­ï¸ ä¸‹ä¸€æ­¥

å®Œæˆæ­¤éšæ®µå¾Œ,è«‹ç¹¼çºŒ **éšæ®µ 3: èº«ä»½åˆ‡æ›å™¨ - äº’å‹•èˆ‡ç‹€æ…‹** (`03-èº«ä»½åˆ‡æ›å™¨-äº’å‹•èˆ‡ç‹€æ…‹.md`)
