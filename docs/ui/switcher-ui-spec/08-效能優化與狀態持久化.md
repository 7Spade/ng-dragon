# éšæ®µ 8ï¸âƒ£: æ•ˆèƒ½å„ªåŒ–èˆ‡ç‹€æ…‹æŒä¹…åŒ–

## ğŸ¯ ç›®æ¨™

å„ªåŒ–æ•ˆèƒ½ä¸¦å¯¦ä½œç‹€æ…‹æŒä¹…åŒ–:
- è™›æ“¬æ»¾å‹• (å·¥ä½œå€æ•¸é‡ > 50)
- @defer å»¶é²è¼‰å…¥
- LocalStorage æŒä¹…åŒ–
- Firestore åŒæ­¥

**é ä¼°æ™‚é–“**: 3-4 å°æ™‚

---

## ğŸ“ æ­¥é©Ÿ 1: è™›æ“¬æ»¾å‹•

### 1.1 ä½¿ç”¨ CDK Virtual Scroll

```typescript
// workspace-switcher.component.ts
import { CdkVirtualScrollViewport, ScrollingModule } from '@angular/cdk/scrolling';

@Component({
  imports: [
    // ... å…¶ä»– imports
    ScrollingModule
  ]
})
export class WorkspaceSwitcherComponent {
  protected useVirtualScroll = computed(() => {
    return this.workspaceList.workspaces().length > 50;
  });
}
```

### 1.2 æ¨¡æ¿

```html
<!-- å·¥ä½œå€åˆ—è¡¨ -->
@if (useVirtualScroll()) {
  <cdk-virtual-scroll-viewport itemSize="64" class="workspace-list">
    @for (workspace of filteredWorkspaces(); track workspace.id) {
      <button mat-menu-item class="workspace-item">
        <!-- å…§å®¹ -->
      </button>
    }
  </cdk-virtual-scroll-viewport>
} @else {
  @for (workspace of filteredWorkspaces(); track workspace.id) {
    <button mat-menu-item class="workspace-item">
      <!-- å…§å®¹ -->
    </button>
  }
}
```

---

## ğŸ“ æ­¥é©Ÿ 2: å»¶é²è¼‰å…¥

### 2.1 ä½¿ç”¨ @defer

```html
<!-- å‘½ä»¤é¢æ¿ - åªåœ¨éœ€è¦æ™‚è¼‰å…¥ -->
@defer (on interaction) {
  <app-workspace-command-palette />
} @placeholder {
  <div class="loading">Loading...</div>
}
```

---

## ğŸ“ æ­¥é©Ÿ 3: LocalStorage æŒä¹…åŒ–

### 3.1 å»ºç«‹æŒä¹…åŒ–æœå‹™

```typescript
// persistence.service.ts
import { Injectable } from '@angular/core';

@Injectable({ providedIn: 'root' })
export class PersistenceService {
  saveCurrentWorkspace(workspaceId: string): void {
    localStorage.setItem('currentWorkspaceId', workspaceId);
  }
  
  loadCurrentWorkspace(): string | null {
    return localStorage.getItem('currentWorkspaceId');
  }
  
  saveFavorites(favoriteIds: string[]): void {
    localStorage.setItem('favoriteWorkspaceIds', JSON.stringify(favoriteIds));
  }
  
  loadFavorites(): string[] {
    const data = localStorage.getItem('favoriteWorkspaceIds');
    return data ? JSON.parse(data) : [];
  }
}
```

### 3.2 åœ¨ Store ä¸­ä½¿ç”¨

```typescript
// workspace-list.store.ts
export const WorkspaceStore = signalStore(
  { providedIn: 'root' },
  
  withMethods((store) => {
    const persistence = inject(PersistenceService);
    
    return {
      setCurrentWorkspace: (workspaceId: string) => {
        patchState(store, { currentWorkspaceId: workspaceId });
        
        // æŒä¹…åŒ–
        persistence.saveCurrentWorkspace(workspaceId);
      },
      
      toggleFavorite: (workspaceId: string) => {
        const favorites = store.favorites();
        const newFavorites = favorites.includes(workspaceId)
          ? favorites.filter(id => id !== workspaceId)
          : [...favorites, workspaceId];
        
        patchState(store, { favorites: newFavorites });
        
        // æŒä¹…åŒ–
        persistence.saveFavorites(newFavorites);
      }
    };
  })
);
```

---

## ğŸ“ æ­¥é©Ÿ 4: Firestore åŒæ­¥

### 4.1 åŒæ­¥ä½¿ç”¨è€…åå¥½

```typescript
// workspace.service.ts
async syncUserPreferences(userId: string): Promise<void> {
  const prefsRef = doc(this.firestore, 'userPreferences', userId);
  const snapshot = await getDoc(prefsRef);
  
  if (snapshot.exists()) {
    const data = snapshot.data();
    
    // æ›´æ–°æœ¬åœ° Store
    this.workspaceList.setFavorites(data['favoriteWorkspaceIds'] || []);
    this.workspaceList.setRecents(data['recentWorkspaceIds'] || []);
  }
}

async saveUserPreferences(userId: string): Promise<void> {
  const prefsRef = doc(this.firestore, 'userPreferences', userId);
  
  await setDoc(prefsRef, {
    favoriteWorkspaceIds: this.workspaceList.favorites(),
    recentWorkspaceIds: this.workspaceList.recents()
  }, { merge: true });
}
```

---

## âœ… é©—è­‰æ¸…å–®

- [ ] è¶…é 50 å€‹å·¥ä½œå€æ™‚ä½¿ç”¨è™›æ“¬æ»¾å‹•
- [ ] å‘½ä»¤é¢æ¿å»¶é²è¼‰å…¥
- [ ] ç•¶å‰å·¥ä½œå€æŒä¹…åŒ–åˆ° LocalStorage
- [ ] æˆ‘çš„æœ€æ„›æŒä¹…åŒ–
- [ ] Firestore åŒæ­¥æ­£å¸¸

---

## â­ï¸ ä¸‹ä¸€æ­¥

ç¹¼çºŒ **éšæ®µ 9: æ¸¬è©¦èˆ‡æ–‡ä»¶**
